## hercjos: Hercules Job Output System 

### Table of content

- [Synopsis](#user-content-synopsis)
- [Description](#user-content-description)
- [Options](#user-content-options)
- [Usage](#user-content-usage)

### Synopsis <a name="synopsis"></a>
```
  hercjos [OPTIONS]... 
```

### Description <a name="description"></a>
hercjos is yet another sockdev printer for
[Hercules](https://en.wikipedia.org/wiki/Hercules_(emulator)).
Simple, open source, and at this point handling only JES2 output
as generated by MVS 3.8J as distributed in the
[tk4-](http://wotho.ethz.ch/tk4-/) system.
The basic operation is
- connect to a printer sockdev device (see [-a option](#user-content-opt-a))
  or open an input file (see [-i option](#user-content-opt-i))
- scan the input for a banner page
- extract job type. job number, job name, user name, printer name and the
  time stamp from the banner page
- open a file with a configurable naming pattern (see
  [-p option](#user-content-opt-p)) and write the job output into this file,
  the banner and trailer pages can be omitted (see
  [-db](#user-content-opt-db) and [-dt](#user-content-opt-dt) options).

The net effect is that the printer output stream is split into a set
of files, containing one job each, with naming pattern like
```
2018-04-07-07:55:27_J0032_PERF-ASM.prt
2018-04-07-08:00:19_J0033_PERF-ASM.prt
2018-04-07-08:05:02_J0034_PERF-ASM.prt
...
2018-04-07-11:47:47_S0046_MF1.prt
2018-04-07-11:59:23_J0062_SHUTDWN.prt
2018-04-07-12:00:13_S0047_TSO.prt
```

### Options <a name="options"></a>

| Option | Description |
| ------ | :---------- |
| [-a [nam:]port](#user-content-opt-a) | sockdev address, default localhost:14030 |
| [-i file](#user-content-opt-i)     | use `file` as input source |
| [-p pat](#user-content-opt-p)      | set file name pattern |
| [-db](#user-content-opt-db)        | drop banner pages |
| [-dt](#user-content-opt-dt)        | drop trailer pages |
| [-h](#user-content-opt-h)          | print help text |

#### -a [nam:]port <a name="opt-a"></a>
hercjos uses as default socket address localhost:14030, often used when
the primary printer is setup as a sockdev device.
The `-a` option allows to specify a different socket address. If only a
port number is specified `localhost` will be used as host name.

#### -i file <a name="opt-i"></a>
Will use `file` as input source instead of connecting to a sockdev
device. Can be used to convert existing files like `prt00e.txt`.

#### -p pat <a name="opt-p"></a>
Defines the file name pattern used to generate the file names for
individual jobs. Default is `%D_%J_%N.prt`. The available specifiers are

| Spec | Content |
| :--: | ------- |
| %T   | job type, either JOB, TSO, or STC |
| %J   | job number in the form Jxxxx, Txxxx, or Sxxxx |
| %N   | job name |
| %U   | user name |
| %P   | printer name |
| %D   | date/time in the format yyyy-mm-dd:hh:mm:ss |

All fields are sanitized, `#`, `@` and `$` are first mapped to `-`, all
characters other than letters, digits and `-` are discarded. The pattern
can contain `/` characters, in that case the job files will be organized
in directories, which will be created as needed.

#### -db <a name="opt-db"></a>
Banner pages will no be written to the job output files. Since all
relevant information contained in the banner page is usually encoded
already in the file name there is in practice little need to keep them.

#### -dt <a name="opt-dt"></a>
Trailer pages will no be written to the job output files. Since
trailer pages are fully redundant and serve no purpose after the
printer stream has been split into job output files there is in
practice no need to keep them.

#### -h <a name="opt-h"></a>
Print a brief help text and exit.
All other options and arguments will be ignored.

### Usage <a name="usage"></a>
The most common usage in the context of a
[tk4-](http://wotho.ethz.ch/tk4-/) system is to connect hercjos to the
default printer `00E`. As first step set this printer up as sockdev device
```
  devinit 00E 14030 sockdev
```
than start hercjos, e.g. like
```
  hercjos -db -dt
```
The job files will be written into the current working directory using
a name pattern setup with the [-p option](#user-content-opt-p).

Hercjos will print some trace information to STDOUT, like
```
hercjos-I: head  'A JOB   55 PERF#ASM WFJM                 2018-04-07-09:44:51'
hercjos-I: write '2018-04-07-09:44:51_J0055_PERF-ASM.prt'
hercjos-I: close written   9p,   518l; dropped   2p,    66l
...
hercjos-I: head  'A JOB   62 SHUTDWN  WFJM                 2018-04-07-11:59:23'
hercjos-I: write '2018-04-07-11:59:23_J0062_SHUTDWN.prt'
hercjos-I: close written   5p,    75l; dropped   2p,    66l
hercjos-I: head  'A STC   47 TSO                           2018-04-07-12:00:13'
hercjos-I: write '2018-04-07-12:00:13_S0047_TSO.prt'
hercjos-I: close written   1p,    30l; dropped   2p,    66l
hercjos-I finished after  1685474 byte,  23677 lines,  516 pages,   48 jobs
```
