## hercjsu: Job Summary 

### Table of content

- [Synopsis](#user-content-synopsis)
- [Description](#user-content-description)
- [Options](#user-content-options)
- [Usage](#user-content-usage)
- [See also](#user-content-also)

### <a id="synopsis">Synopsis</a>
```
  hercjsu [OPTIONS]... [FILE]...
```

### <a id="description">Description</a>
hercjsu analyses batch job output files and generates compact, one line
per job step, summaries. Filters allow to select on job names (see
[--job option](#user-content-opt-job)) or on step names (see
[--step option](#user-content-opt-step)) or failed steps (see
[--fail option](#user-content-opt-fail)).
hercjsu expects JES2 printer output as generated by MVS 3.8J as
distributed in the [tk4-](http://wotho.ethz.ch/tk4-/) system and
extracts information from the `IEF403I` to `IEF404I` section and from
the `Jobstep` box.

If used without filters and options the output has the form
```
2018-04-07-09:16:24_J0049_PERF-ASM.prt:
  J0049 PERF#ASM CLG      ASM      IFOX00    RC= 0000  00:00:04,36  2108K      0
  J0049 PERF#ASM CLG      LKED     IEWL      RC= 0000  00:00:01,08   504K      0
  J0049 PERF#ASM CLG      GO       PGM=*.DD  RC= 0000  00:04:39,53   120K      0
```

or for a less lucky job
```
2017-09-16-23:01:41_J0515_HEWO-ASM.prt:
  J0515 HEWO#ASM CLG      ASM      IFOX00    RC= 0000  00:00:00,20   128K      0
  J0515 HEWO#ASM CLG      LKED     IEWL      RC= 0016  00:00:00,01   128K      0
  J0515 HEWO#ASM CLG      GO       PGM=*.DD  *FLUSH*             ?      ?      ?
```

listing the input file name, and for each job step
- job number
- job name
- step name
- step program
- step return code
- step CPU time in hh:mm:ss.ss format
- step virtual storage used
- step Page-in count

The GO step information is sometimes missing in the output, e.g. for GO steps
with very small CPU time. In this case the last three columns contain a `?`.

When the [--cfrac option](#user-content-opt-cfrac) is used the output format
changes to
```
2018-04-07-09:16:24_J0049_PERF-ASM.prt:
  J0049 PERF#ASM CLG      ASM      IFOX00    RC= 0000      4.36s  91.21%  2108K
  J0049 PERF#ASM CLG      LKED     IEWL      RC= 0000      1.08s  81.82%   504K
  J0049 PERF#ASM CLG      GO       PGM=*.DD  RC= 0000    279.53s  99.89%   120K
```

and the last three columns show
- step CPU time in seconds
- step CPU/elapsed time ratio
- step virtual storage used

Note that on system with multiple CPUs, like a dual CPU MVS 3.8J system, the
CPU time can be larger than the elapsed time, so the ratio be larger than 100%.


### <a id="options">Options</a>

| Option | Description |
| ------ | :---------- |
| [--job=jnam](#user-content-opt-job)  | show only jobs with given job name |
| [--step=snam](#user-content-opt-step) | show only steps with given step name |
| [--fail](#user-content-opt-fail)     | show jobs with failed steps |
| [--nofile](#user-content-opt-nofile) | don't print file name header |
| [--cfrac](#user-content-opt-cfrac)   | show CPU time and CPU/elapsed ratio |
| [--asum](#user-content-opt-asum)     | add job/step average times |
| [--osum](#user-content-opt-osum)     | show only job/step average times |
| [--help](#user-content-opt-help)     | print help text |

#### <a id="opt-job">--job=jname</a>
`jname` is taken as
[PERL regular expression](https://perldoc.perl.org/perlre.html),
only jobs matching `jname` are listed. Examples:
- `--job=PERF.*` selects jobs names which start with PERF
- `--job="TOWH#.CC"` selects jobs with names like `TOWH#GCC` and `TOWH#JCC`
  Note that the option argument must be quoted because it contains a
  shell meta character (`#`).

#### <a id="opt-step">--step=sname</a>
`sname` is taken as
[PERL regular expression](https://perldoc.perl.org/perlre.html),
only steps matching `sname` are listed. To select the GO step use
for example `--step=GO`.

#### <a id="opt-fail">--fail</a>
Selects jobs which have at least one failed step. A job step is considered
failed when the return code is higher than 4 or an ABEND condition was
detected.

#### <a id="opt-nofile">--nofile</a>
Suppresses the file name header. Is especially useful when the
[--step option](#user-content-opt-step) is used and results in very
compact listings.

#### <a id="opt-cfrac">--cfrac</a>
Show the CPU time in seconds and the CPU/elapsed time ratio and omit the Page-in
count in the output format.

#### <a id="opt-asum">--asum</a>
Adds at end of output a job/step summary of the format
```
jobname   stepname  ns       CPU   C-w50   elapsed   e-w50  CPU/ela   vmem  pgin
PERF#ASM  ASM       31     3.85s   2.99%     4.23s   3.66%   91.02%  2108K     0
PERF#ASM  LKED      31     0.95s   3.68%     1.16s   4.31%   81.90%   504K     0
PERF#ASM  GO        31   292.66s   5.08%   293.08s   5.10%   99.86%   120K     0
```

showing for each jobname/stepname combination found
- number of steps seen
- median value of CPU time
- 50% width of CPU time distribution
- median value of elapsed time
- 50% width of elapsed time distribution
- ratio of CPU time to elapsed time
- median value of virtual memory usage
- median value of page-in's

The [median](https://en.wikipedia.org/wiki/Median) values and 50% width are
determined from
[cumulative distribution functions](https://en.wikipedia.org/wiki/Cumulative_distribution_function)
of the respective quantities and give a
[robust estimator](https://en.wikipedia.org/wiki/Robust_statistics)
for the typical behavior.

#### <a id="opt-osum">--osum</a>
Prints only the job/step summary decribed for the
[-asum option](#user-content-opt-asum), all other output is suppressed.

#### <a id="opt-help">--help</a>
Print a brief help text and exit.
All other options and arguments will be ignored.

### <a id="usage">Usage</a>
When hercjsu is used in conjunction with [hercjos](hercjos.md) with the
default file pattern it is advisable to select file names as `*_J*.prt`.

To get a one line-per-job GO step summary use
```
hercjsu --step=GO --cfrac --nofile *_J*.prt
```
which generates output like
```
  jnum  jobname  execname stepname progname  ret-code   cpu-time CPU/ela   vmem
  J6373 TOWH#A60 CLG      GO       GO        RC= 0000    260.46s  99.93%    32K
  J6374 TOWH#ASM CLG      GO       PGM=*.DD  RC= 0000      5.01s 100.00%     8K
  J6375 TOWH#FOG CLG      GO       PGM=*.DD  RC= 0000     15.35s  99.80%    28K
  J6376 TOWH#FOH CLG      GO       PGM=*.DD  RC= 0000      9.27s  99.78%    28K
  J6377 TOWH#FOW CLG      GO       WATFIV    RC= 0000     93.26s  99.85%   256K
  J6378 TOWH#GCC CLG      GO       PGM=*.DD  RC= 0000      9.06s  99.78%   444K
  J6379 TOWH#JCC CLG      GO       GO        RC= 0000      9.14s  99.78%   424K
  J6380 TOWH#PAS CLG      GO       PGM=*.DD  RC= 0000      7.36s  99.19%   576K
  J6381 TOWH#PLI CLG      GO       PGM=*.DD  RC= 0000     56.74s  99.91%    48K
  J6382 TOWH#SIM CLG      GO       PGM=*.DD  RC= 0000     34.53s  99.91%  1000K
```

### <a id="also">See also</a>
- [hercjis](hercjis.md) - Hercules Job Input System 
- [hercjos](hercjos.md) - Hercules Job Output System 
